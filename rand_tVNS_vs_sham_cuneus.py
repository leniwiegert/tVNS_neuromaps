# AUTHOR: Lena Wiegert
# Permutation of the tVNS effect

import numpy as np
from neuromaps.datasets import fetch_annotation
from neuromaps.resampling import resample_images
from neuromaps.stats import compare_images
from nilearn import image as nli
import os
import nibabel as nib
import matplotlib.pyplot as plt
from tqdm import tqdm

'''
#-------- PREPARE DATA --------#

# Directory containing the volume files
data_directory = '/home/leni/Documents/Master/data/'

# List of volume files in the directory
volume_files = [f for f in os.listdir(data_directory) if f.startswith('volume_') and f.endswith('.nii')]

# Specify the gray matter mask file
#gray_matter_mask_file = '/Users/leni/Documents/Master/Data/out_GM_p_0_15.nii'
gray_matter_mask_file = os.path.join(data_directory, 'out_GM_p_0_15.nii')
gray_matter_mask = nib.load(gray_matter_mask_file)


#-------- GRAY MATTER MASK --------#

# Create an empty dictionary to store the non_rand mask data for each volume
non_rand_mask_data_dict = {}

# Iterate over each volume file
for volume_file in volume_files:
    # Load the volume image
    volume_path = os.path.join(data_directory, volume_file)
    img = nib.load(volume_path)

    # Resample gray matter mask to match the resolution of the volume image
    gray_matter_mask_resampled = nli.resample_to_img(gray_matter_mask, img)

    # Create a new mask by keeping only non-NaN values in both masks
    non_rand_mask_data = np.where(np.isnan(img.get_fdata()), gray_matter_mask_resampled.get_fdata(), img.get_fdata())

    # Save the non_rand mask data for this volume in the dictionary
    non_rand_mask_data_dict[volume_file] = non_rand_mask_data

    # Create a new image with the non_rand mask
    non_rand_mask_img = nib.Nifti1Image(non_rand_mask_data.astype(np.float32), img.affine)

    # Save the non_rand mask image
    #non_rand_mask_img.to_filename(f'/Users/leni/Documents/Master/Data/{volume_file}_non_rand_mask.nii.gz')
    non_rand_mask_img.to_filename(os.path.join(data_directory, f"{volume_file}_non_rand_mask.nii.gz"))
    #print(f"File saved: {volume_file}_non_rand_mask.nii.gz")

    # Save the randomized data array for this volume in the dictionary
    #rand_data_arrays_gm[volume_file] = rand_mask_data

    # Optionally, save the randomized mask data as a NIfTI file
    #rand_mask_img = nib.Nifti1Image(rand_mask_data.astype(np.float32), img.affine)
    #rand_mask_img.to_filename(f'/Users/leni/Documents/Master/Data/{volume_file}_rand_mask.nii.gz')


# List of annotation sources
annotation_sources = ['alarkurtti2015', 'ding2010', 'fazio2016', 'gallezot2010', 'hesse2017',
                      'jaworska2020', 'kaller2017', 'radnakrishnan2018', 'sandiego2015', 'sasaki2012', 'smith2017']

# Number of iterations for randomization
num_iterations = 2  # Adjust as needed

# List to store p-values
p_values = []

# List to store correlation values for the original data
corr_values_orig = []

# List to store correlation values for the randomized data
corr_values_rand = []
# Loop through each annotation source with tqdm for progress bar
for source in tqdm(annotation_sources, desc="Annotation Sources"):
# Loop through each annotation source
#for source in annotation_sources:
#    print(f"\n----- Annotation Source: {source} -----")

    # Fetch desired annotation
    anno = fetch_annotation(source=source)

    # Load the mean image of the original data
    #mean_orig_img = nib.load(f'/Users/leni/Documents/Master/Data/combined_mask.nii.gz')
    mean_orig_img = nib.load(os.path.join(data_directory, 'combined_mask.nii.gz'))

    # Resample the original data to match the annotation space
    data_res_orig, anno_res = resample_images(src=mean_orig_img, trg=anno,
                                              src_space='MNI152', trg_space='MNI152',
                                              method='linear', resampling='downsample_only')

    # Compare resampled original data with neuromaps annotation
    corr_value_orig = compare_images(data_res_orig, anno_res, metric='pearsonr')

    # Store correlation value for the original data
    corr_values_orig.append(corr_value_orig)

    # Print the correlation result for the original data
    print(f'Correlation with Original Mean Image: {corr_value_orig}')

    # Loop for the specified number of iterations
    for iteration in range(num_iterations):
        # Assuming non_rand_mask_data_dict is a dictionary with 41 arrays
        for key, volume_data in non_rand_mask_data_dict.items():
            # Generate a random array of 1s and -1s with the same shape as the volume data
            random_multiplier = np.random.choice([-1, 1], size=volume_data.shape)

            # Multiply each value in the volume data by the corresponding value in the random array
            randomized_data = volume_data * random_multiplier

            # Update the original data array with the randomized values
            non_rand_mask_data_dict[key] = randomized_data

            # np.eye(4) creates a 4x4 identity matrix, used as the affine transformation matrix when creating the new NIfTI image
            # Adjust if needed
            affine_matrix = np.eye(4)

            # Create a new NIfTI image with the randomized data
            randomized_img = nib.Nifti1Image(randomized_data, affine_matrix)

            # Save the randomized image to a new file
            randomized_file_path = os.path.join(data_directory, f"randomized_{key}.nii.gz")
            nib.save(randomized_img, randomized_file_path)

            # Print a message indicating the randomization for each key
            #print(f"Randomized data for key: {key}")

        # List all randomized NIfTI files
        rand_files = [f for f in os.listdir(data_directory) if f.startswith('randomized_') and f.endswith('.nii.gz')]

        # Initialize an array to store the data of each randomized image
        rand_data_list = []

        # Load data from each randomized NIfTI image
        for rand_file in rand_files:
            rand_file_path = os.path.join(data_directory, rand_file)
            img = nib.load(rand_file_path)
            rand_data = img.get_fdata()
            rand_data_list.append(rand_data)

        # Compute the mean of the randomized data along the first axis (axis=0)
        mean_rand_data = np.mean(rand_data_list, axis=0)

        # Assuming the first randomized image has the correct affine matrix
        affine_matrix = nib.load(os.path.join(data_directory, rand_files[0])).affine

        # Create a new NIfTI image with the mean data
        mean_rand_img = nib.Nifti1Image(mean_rand_data, affine_matrix)

        # Save the mean NIfTI image to a file
        mean_rand_file_path = os.path.join(data_directory, "mean_randomized.nii.gz")
        nib.save(mean_rand_img, mean_rand_file_path)

        # Resample the original data to match the annotation space
        data_res_rand, anno_res = resample_images(src=mean_rand_img, trg=anno,
                                                  src_space='MNI152', trg_space='MNI152',
                                                  method='linear', resampling='downsample_only')

        # Compare resampled original data with neuromaps annotation
        corr_random = compare_images(data_res_rand, anno_res, metric='pearsonr')

        # Print the correlation result for the randomized data
        print(f'Correlation with Randomized Mean Image (Iteration {iteration + 1}): {corr_random}')

        # Store correlation value for the randomized data
        corr_values_rand.append(corr_random)

    # Calculate p-value
    p_value = (np.sum(np.abs(corr_values_rand) >= np.abs(corr_value_orig)) + 1) / (len(corr_values_rand) + 1)
    print(f'P-value for {source}: {p_value}')
    p_values.append((source, p_value))

# Keep only the first 11 correlation values for the original data (change depending on the nr. of annos)
#corr_values_orig = corr_values_orig[:11]

# Print the list of correlation values for the original data
print("Correlation values for the original data:", corr_values_orig)

# Print the list of correlation values for the randomized data
print("Correlation values for the randomized data:", corr_values_rand)

# Print the p-values with the corresponding annotation sources
print("List of p-values:")
for source, p_value in p_values:
    print(f"{source}: {p_value}")

'''

# Result:
# List of p-values:
# alarkurtti2015: 0.001998001998001998
# ding2010: 0.0004997501249375312
# fazio2016: 0.15561479506831055
# gallezot2010: 0.0024993751562109472
# hesse2017: 0.07398520295940812
# jaworska2020: 0.006165639060156641
# kaller2017: 0.12483930867018997
# radnakrishnan2018: 0.0074990626171728535
# sandiego2015: 0.04021775358293523
# sasaki2012: 0.0013998600139986002
# smith2017: 0.03517862012544314

'''
/usr/bin/python3.8 /mnt/ghrelin/tvns_neuromaps/rand_tVNS_vs_sham_cuneus.py 
Annotation Sources:   9%|▉         | 1/11 [2:07:29<21:14:52, 7649.21s/it]P-value for alarkurtti2015: 0.001998001998001998
Annotation Sources:  18%|█▊        | 2/11 [4:17:11<19:19:08, 7727.56s/it]P-value for ding2010: 0.0004997501249375312
P-value for fazio2016: 0.15561479506831055
Annotation Sources:  36%|███▋      | 4/11 [8:29:44<14:52:08, 7647.00s/it]P-value for gallezot2010: 0.0024993751562109472
P-value for hesse2017: 0.07398520295940812
Annotation Sources:  55%|█████▍    | 6/11 [12:43:03<10:36:38, 7639.79s/it]P-value for jaworska2020: 0.006165639060156641
P-value for kaller2017: 0.12483930867018997
Annotation Sources:  73%|███████▎  | 8/11 [16:58:56<6:23:31, 7670.36s/it]P-value for radnakrishnan2018: 0.0074990626171728535
Annotation Sources:  82%|████████▏ | 9/11 [19:09:44<4:17:31, 7725.69s/it]P-value for sandiego2015: 0.04021775358293523
Annotation Sources:  91%|█████████ | 10/11 [21:21:05<2:09:33, 7773.62s/it]P-value for sasaki2012: 0.0013998600139986002
Annotation Sources: 100%|██████████| 11/11 [23:29:58<00:00, 7690.79s/it]
P-value for smith2017: 0.03517862012544314
Correlation values for the original data: [-0.09825030223635678, -0.1456492918719523, -0.03754042952172708, -0.08235165752460845, -0.04091022193747271, -0.07051887039497798, -0.026292923517916438, -0.06534871934176038, -0.04145179078821774, -0.07794207142407676, -0.040404619037750486]
'''

#Correlation values for the randomized data:
corr_values_rand = [0.009837356334641903, -0.013810892136276606, 0.02396846125108127, -0.011386127481626042, 0.01867181172523683, 0.014075188511571093, -0.019761345808393428, 0.004952665553188306, 0.007934149523234962, 0.018214460664176504, 0.03607442729190162, -0.05967842219826153, 0.0177525511166782, -0.005832960826362401, -0.0035282599544938253, -0.028045850366336594, -0.003355642390082233, -0.0016447626669635973, -0.042287577763021236, 0.017835086362356027, 0.03259771979943438, 0.004235011540121303, -0.026523714268958925, -0.03277111841094539, -0.025682988600603567, -0.027220364300190574, 0.02113807106848992, -0.01780510596543784, -0.009458157275461076, -0.025897646121339078, -0.0008734657532591662, -0.04060582844300412, -0.028211679645697842, 0.005203970668381943, 0.00984976345308827, 0.047188701939432844, -0.03870827777085755, 0.0026430691977897456, 0.026298474779344466, -0.01425778559088252, 0.013538108702348808, -0.010736387138460033, 0.014776859781930607, 0.001974152479912863, -0.009842999389763919, -0.005119858458545728, 0.01827067135978255, 0.02959552075349575, 0.006068960498835197, 0.03717997929135607, -0.03067072726640928, 0.03373347334647291, -0.026544782373380066, 0.059568309041130224, 0.027614522726925324, -0.045587400570705414, 0.017523475151002634, -0.007417463003410689, 0.039185126542565285, 0.005359660826710995, -0.004651636232282355, -0.032897813298882424, 0.01682676469024515, 0.013177693118751171, 0.01754201851189906, 0.02425353194261232, -0.0008044881830683451, 0.011387498322511598, 0.039438085160447986, -0.0025118126776690268, 0.00479252547719257, -0.04430147087560029, 0.048943814241006495, 0.03686809381934459, -0.061602087478898865, 0.02995912352436133, 0.048712017941451316, -0.04087139958849466, 0.05040175093735432, 0.001142811256142057, 0.0570037942789958, 0.00522843303392674, -0.04256868770807014, 0.06246663823177346, -0.02311674186427752, 0.028314936685560788, -0.03800212008428374, -0.03542369451936583, 0.0131539327525915, 0.03029196078018851, -0.0026780037588137805, 0.06246003155641539, 0.058026998417700246, 0.021035961203266704, -0.011484316566853383, -0.010999332508468967, 0.0008707406124603709, -0.0007625252002290938, 0.04205972994845419, 0.030122780190008542, -0.04875869462641632, -0.02574864433572544, -0.005762169509466236, 0.038051694052906836, 0.043310373288820904, 0.0007230535121759485, -0.02728783174573702, -0.0008630505415264385, -0.03645234825950131, 0.005647654328811186, -0.00578778705523878, -0.0014048624094899482, -0.0018159911979172807, -0.02609582025728593, 0.0257207159431299, -0.06189831887013048, 0.04081827232581639, 0.003408759634891569, -0.0003920553547335351, 0.04208806870532516, -0.0160988537261684, -0.01837478081509774, -0.011086230708698179, -0.028370336437684128, 0.036023067913677084, -0.07824941406147427, -0.0008327989780252976, 0.013828517275091294, -0.02498878437679778, 0.009232707906989924, -0.003860753273010412, 0.003658877891191821, 0.0011969326029327451, 0.02824575064871006, -0.01639061750797487, 0.009415905447452147, -0.013418140686467368, 0.01011139804298343, -0.009545058404346433, 0.009055242471512601, -0.001766575542675016, -0.001436576822404699, -0.017476493096378238, 0.003236509220998768, -0.015393841659679513, -0.020097259595663657, -0.024148231136363815, 0.0022444920582334106, 0.006866747262809632, 0.024061273777032814, 0.021063205912649558, -0.024295053030807864, -0.025228936246643394, 0.042811913753550014, -0.026045665710308495, 0.0011159373076267125, -0.011787900643679164, 0.018318795607410558, -0.001389447155168409, -0.003121277363962006, 0.0007391271591658328, -0.005367806151805923, 0.004456961555140201, -0.0012151554448989704, -0.02626103407787593, 0.04202052414946242, 0.012743713960470162, -0.0060173654196708296, 0.003242336616645346, 0.03948370864633917, -0.009903611750968525, 0.00669384488419091, 0.010218851651257823, 0.0011904885508148527, -0.02309889622988508, 0.0039058814418076945, -0.017758636040773153, -0.020654130333843036, -0.009108769942550938, -0.01547883749713112, 0.005055778100295739, 0.0236593965756117, -0.01584246834611659, -0.007107299652907236, 0.03178640925066474, -0.013606453954222074, -0.03311460145632679, -0.0253139759475913, -0.01966560416670917, -0.016823718594522703, 0.03845737143916314, -0.01724103936315616, 0.009965157114939002, -0.028229380109044237, -0.021396932039264467, 0.03610394327135986, 0.003720203148504914, -0.02054180692501624, -0.02379215860113829, -0.009846251420097351, -0.030637296420083223, 0.013648616880818996, -0.01457722400903702, 0.017818929317539214, -0.0062302284974421265, 0.023111918256197392, -0.03363753114587532, -0.037255621513916246, 0.045644454336083634, 0.03935049423076686, -0.015791506923563816, 0.014804717652416385, -0.05131828482327716, 0.01362658968728875, 0.045823453991597346, -0.014937771285617539, -0.0085224414700556, 0.011825157756506397, -0.03785657582831361, -6.060837208843354e-05, -0.04254249333217012, 0.007445764091998913, 0.011076736915332763, -0.053438843416928956, -0.024364012376731185, 0.0022441827482695014, -0.038302340856987346, -0.013494916276371189, 0.001183603629531419, -0.008842806607746435, 0.007265051150006348, 0.03682392468797412, 0.04090830160002328, -0.008613517954093673, -0.04115890960854756, -0.01993703655930607, 0.05540908917420666, -0.0324678253647918, 0.0007743057255487713, 0.01877610630806315, 0.04944018653376677, 0.016567656648512293, 0.014750249764861691, -0.02757755805588485, 0.032565714728451156, -0.031751336090535535, 0.013118743496351322, -0.02084502719044245, -0.042374690122622995, 0.0048922520603007615, -0.008425301895461859, -0.055015630344441666, 0.0028666756827691706, 0.008114953427366473, -0.014051729023909311, -0.04087357829477638, -0.01842244703550191, 0.0034455410920197532, 0.04621659184753242, -0.03259468635561015, -0.019032630323488432, 0.013363398329057238, -0.0004728767120199831, -0.020241458581763266, -0.001819155922749514, -0.008381386365927328, 0.000566704977716827, 0.008466483587403827, -0.016051407246587504, -0.027277043344073246, -0.022069796727267832, 0.009268726755353415, 0.06982034987782448, -0.010538277188445331, 0.056287867852856666, -0.020142927258722104, 0.0014708712567073493, -0.024670595859430332, -0.016742596572218386, 0.05149099672085763, 0.042747636630653965, 0.019642103575741095, 0.006564329758441121, 0.013651425586009625, -0.03644571785435143, 0.012082117038458613, 0.017467063997089596, -0.0038041061363306627, 0.06142151044575193, -0.07972169552882853, -0.008959423109372578, -5.982449326101106e-05, 0.0010684275013022307, 0.023980347045455527, -0.011900186762877733, 0.009164345378705745, -0.03209849289755683, -0.039589635016290044, 0.029165545088053642, 0.04237790330085101, 0.01906118707094671, -0.019077181402729987, 0.0119076373874183, -0.02471630056114453, 0.052969243238020804, -0.007887820099046894, 0.006464805089006839, -0.05333476906871952, 0.030836402157974, -0.055127767939199296, 0.02838724885794669, 0.02694066187162733, -0.027018638119791712, -0.013833900287985812, 0.02721419060306719, 0.03640491817712582, 0.051776840413244186, -0.03701943697545788, 0.013278818571791699, -0.00970748593047864, -0.015452348666415837, -0.052961162825308356, 0.01489980049147226, -0.03240601430401444, 0.02594655601817148, -0.0034045640587633554, 0.01545089076287189, -0.0070069628052759165, 0.028361572197138918, 0.003474854292465983, -0.07350229218880919, -0.006987839744778912, -0.020656057725652436, -0.0032913946904443874, -0.02259256429543825, -0.038272220829933826, -0.002077414950249677, -0.02941931795393262, -0.011875590279562037, 0.040463569830887655, -0.02376134089891238, 0.02901833788738098, -0.05979161096094408, -0.005907745623804939, -0.0038657583749645737, -0.06879950328304478, 0.007008291385994272, -0.03818726051661958, 0.014666925338721704, 0.04249927159164535, 0.017234005593862206, 0.05913595003351924, -0.005525296362731322, 0.009476602772005271, 0.06494729047009189, -0.022132488982666277, 0.024433081831889338, -0.03859319849248812, 0.030447451719378387, 0.012717801098824881, -0.007425924272160376, -0.019637017693537543, 0.014463099194499953, 0.008011650518362659, -0.032271577012714506, 0.04494951130080979, -0.016555728187641575, -0.009214593250367515, 0.020706621250807664, -0.033137062661212795, 0.019580765656830434, -0.003372536701734838, 0.011333195294010915, -0.03816317990928127, -0.0011370105302751761, -0.02095011723704062, 0.006723158181835559, 0.06561871408383871, -0.029548336317687086, 0.014269956041470118, 0.003182751619820046, -0.019618928845317286, -0.009321204342837279, -0.013049945859206023, 0.014512396010173444, 0.01874565562095353, -0.010213450185517618, -0.013506268620564935, 0.0062664912322058655, -0.041849640588244724, 0.008296475030131123, 0.006918122275519732, 0.03805586275909948, 0.047890247007043946, -0.04693123811817352, -0.016272702039469764, 0.00491050541896628, -0.005912705032968211, 0.005073430587587713, -0.05024164769127949, -0.017475843745149173, -0.00861363015823619, -0.042529798414965354, 0.013447464815640247, 0.02840207863446427, 0.0012723271612343936, 0.03600839892356646, 0.009847881570141222, -0.009464062456276416, -0.025863233752923216, -0.045506873722810905, -0.0719606790819714, 0.012324617661971975, 0.0006212625045266335, -0.0048700407022546025, 0.044566972602029305, 0.0050462464086351334, 0.009390769962944646, 0.004372241330271821, 0.00045803569196139484, -0.06505308170122337, 0.013743570795632782, -0.03694219636247336, 0.020872004342344926, 0.005826346427381316, 0.0025752763991110164, -0.04003208031818188, -0.007419271218604662, -0.016744216084696516, -0.03783665101725302, 0.0027449526572093123, 0.06499376049877446, -0.020049976487087503, 0.028772641458275884, -0.042207383622022206, -0.005159237536327628, 0.03748389866031254, -0.04322710104877874, 0.027911786782424283, -0.0004114976126041216, 0.015794574526254244, -0.007049884443939985, -0.02093253384742471, -0.021224593042391816, 0.0012609904534354626, 0.08390372325514864, 0.0053296444590349434, 0.01274534640545246, -0.01865653749076611, 0.031578397298211686, 0.05198344391882858, -0.04537596098225282, -0.002279425420683186, -0.02028540558997132, -0.043143742367121284, 0.05024579764518075, 0.02472438542600325, -0.06330919482628018, -0.07107372175406705, -0.02058422905509825, 0.006782693842535474, 0.003419306660683788, 0.06663206105342757, 0.030103206683821857, 0.033628884425881564, 0.033330041930483646, -0.023803665659835882, 0.023427401023629585, -0.03185452887204646, -0.05299320206084204, -0.015581461829120624, -0.040288513426478975, -0.0038976321343075345, -0.007780584836806608, 0.026839933543251735, -0.014077661977425398, 0.03194690737380502, 0.018180685226996056, 0.001436047557010412, 0.05113443146040465, -0.06230822471661382, 0.002629083919774492, -0.021877805397158848, -0.014585680739084133, -0.04792279284401752, 0.0030824451493874135, -0.027642197516052677, -0.019742420599337812, 0.0050253823982216814, 0.029037370578025093, 0.010821808235570654, 0.055590522708423205, -0.01726438943867512, -0.030970937313774278, -0.030456144739468144, 0.05927219499775993, -0.004213102274078358, -0.020794936785744116, 0.003481662985805972, 0.0004190326723488485, 0.012468573741880406, -0.030131274363503546, -0.05837275358485777, -0.012378070571850593, -0.04701467858761216, 0.004127413683992464, 0.004499728468938226, 0.0358315589140881, 0.005922402015499452, 0.020327152681998955, 0.055685316812989806, 0.041984240367697066, -0.03191612838026767, -0.03482645639159274, 0.052444997851672795, -0.03110756396620728, 0.03686250835578157, 0.007641927352579191, -0.03407829118700431, -0.04361444905744425, 0.04931447709029017, 0.04004336281134972, -0.03789757542631627, 0.025515179771843345, -0.012871445134607268, 0.0021139471356879506, 0.04285968342147765, -0.0007501210979570268, -0.017998448170985358, -0.013854358056543838, -0.05228082059112915, 0.029666031634982035, -0.04166398680401115, 0.005194346467567124, -0.033360507187282694, 0.018996450516944038, 0.050796064880995015, -0.03967212000158815, 0.039703204817089784, 0.024460177563714845, 0.04610401540893705, -0.014138215737237265, -0.02992224664546407, -0.006184272899933341, -0.0007198813225936914, -0.013555491281384684, -0.018939680316931256, -0.015193628095517386, 4.453728193513061e-05, 0.04154716471839659, 0.006027688274301588, -0.02085724209522411, -0.012997095650344369, 0.027818588151470498, 0.034679781051589316, 0.0035695017875824173, 0.006580375010814261, 0.02418881020629154, -0.001223485287698878, 0.03852302833050865, -0.010369282978916988, -0.0076262583506627865, 0.021758031402364965, 0.0403228428838403, 0.06982408491871218, -0.01091055901996859, -0.0018347234180371133, 0.003043782727079521, 0.02354902642587142, 0.00541850060400111, -0.02259781783227624, -0.021146064720933312, -0.005333357508928889, -0.03784235424188462, 0.0013033941681360516, -0.04175358062755191, 0.019997354265391277, 0.008282727898428202, -0.016687917383234552, -0.0422806000253078, 0.0028212998075271413, 0.025409912603216143, 0.039989832536423346, -0.00740765104869784, 0.014180499760657531, -0.020368046948411784, -0.04342630711836961, -0.03878606741451039, 0.010140033122603797, -0.01070249877670856, -0.0394905911239235, 0.022649846277525858, 0.04902755708493739, -0.05435907370142814, 0.0317598336473871, 0.004909402168510692, -0.021848130569220546, 0.015921997849070137, 0.014214537807598192, -0.0060576359695274406, -0.03707025175973262, -0.037548849812051345, -0.027130754325211445, -0.038427425389564625, 0.02550787374223218, 0.013329759208868206, 0.00872680454451009, 0.04140962259787826, 0.05408837561791588, -0.014129972737541277, -0.05677084156320183, -0.06304308649955406, -0.02220468333733629, 0.009078421991027288, -0.009283620084187894, 0.014867857309741684, 0.022834650831176376, -0.0069994727902536755, -0.036816117381023104, -0.0018686166856190086, 0.004017762447564783, -0.02601486946373672, -0.005262799398455865, -0.014982863843552914, 0.0005102564078420049, -0.01317800882462707, -0.027325697133287374, 0.012387668666499246, 0.003975903959607488, -0.03304677776494733, -0.013415505531140811, -0.00978187072600095, -0.030361684788158847, 0.0342891927799857, 0.013617816496474356, -0.011948716504083794, 0.004288290405855392, 1.1596623595604747e-05, -0.033156319679822896, -0.027947529640698465, -0.0386288509283345, 0.016965993077817754, 0.010133679019750435, -0.011666314171411346, 0.019349975988910348, -0.010305692160153443, -0.012206927920180988, -0.016026265319506107, -0.0031452804449641097, 0.041855572524671134, -0.03537992537544764, -0.028642977485492428, -0.005018927313598294, -0.02341415553597062, 0.020060196799295542, 0.018576244496623918, -0.04045030128557611, 0.05214554558453527, -0.011492767620883703, -0.02446162031168206, 0.04581289723595574, 0.03442307004551225, 0.035032811133990815, 0.01534555431201097, -0.011271047999194378, -0.023877992058726358, 0.025745288298410163, 0.014186268150926534, -0.0077209093782066775, 0.015777867078744227, -0.008520768900648156, 0.010770698116413546, 0.014793623738056719, 0.05221496335064232, -0.044400306010429595, 0.05752386723492079, 0.034480940126475144, -0.022671174224949932, 0.020195175089779166, 0.02378614141646334, 0.0013043194085625347, -0.0022989560303994677, -0.017763776268222765, -0.043990758247539924, 0.059119709079742934, 0.020707236959065844, 0.01089868495953059, -0.054207817522069865, -0.010136703426421182, 0.04786529848612631, -0.0024182160044544975, 0.05979644755382972, 0.05938423228091968, -0.006820251608211699, -0.002131832164143841, 0.062247111994240704, -0.010919694402374192, 0.00974279834253783, -0.04038536795189589, -0.02824218834481289, 0.007493735538475007, -0.025692284724394714, 0.010489682475086961, -0.020406784521632117, -0.010740463031978731, -0.03607570842822664, -0.003400014183408131, 0.03846776019508206, 0.048822285251809185, 0.0487453513559879, -0.01631620109986528, 0.004251364413837982, -0.05001051000657325, 0.028206279225694363, -0.01269657648526546, 0.04349323944298787, 0.005794629723804932, -0.009503278596751265, -0.05769005806100004, -0.028060064791908264, 0.023684487307144245, 0.01658920904571012, 0.026261319886146803, 0.03859631617629621, 0.07497132092087645, -0.02209972794862388, 0.02566078343168743, -0.026789746831756667, 0.03419297497929652, 0.0625069199139857, 0.02090298249077647, 0.02426546503582974, -0.028736870826951325, 0.009098137433295711, -0.06838359391240376, -0.03394404383222508, -0.006680444595456517, 0.028520182563827403, 0.026782949646604676, -0.021139596667176696, 0.01279384469970127, -0.03146984639321147, -0.027180230907575452, -0.019787036213569115, -0.04698368719579063, 0.012469949442308349, 0.03502022421847183, -0.00015607034410326822, -0.010985713031003607, 0.002284332340494381, -0.01756897085526023, -0.014383801486830262, 0.039180554976349195, 0.005523562532225075, -0.020730163137732127, 0.030273885337098228, -0.01957570167006877, 0.04146565399913208, 0.008749507172223598, -0.029031083318624633, -0.008319610561479658, -0.03764978937326792, -0.009242665993198639, 0.013355417698016672, -0.053691301969586123, -0.009661044082194738, -0.021085908683668494, 0.022955815188290887, 0.014441504033542137, -0.004009408987751144, -0.008280709411994436, 0.019163894237622766, -0.0078185706444036, -0.02538337603846015, 0.0186687740254329, -0.004938198384179523, 0.014134698415372838, 0.03423649575666777, 0.04646452611282289, -0.00945906165964021, -0.03207325862831993, 0.021105931305268402, 0.02595220241151594, 0.019921835674353346, 0.005447071431847323, 0.06586574272431928, 0.0040246127562142886, 0.03391228354699335, 0.01747791765032399, 0.0506665179730055, 0.014812329809869821, 0.043909931703641505, 0.0040038757817110315, 0.06714432990527563, -0.020069790797809448, 0.017710183804313294, -0.03602168121086564, -0.0186272967038979, 0.019343371550997402, -0.03856437387496544, -5.322979727985304e-05, -0.014028164429756402, -0.0397989797333889, -0.03565216363511136, -0.04656609245190887, 0.00333901783385914, 0.06080526524581923, -0.023974782368329606, -0.02708920248357415, 0.006099850834679698, -0.046840464275172376, -0.006681148108658149, 0.00664188415902431, -0.023316369972837092, 0.001782903547128741, -0.0007071054810927191, -0.004002147512214383, 0.011743739523032811, -0.01501223251018894, 0.01526260351362142, -0.010048003193549726, 0.025074893201303683, -0.008568344368561338, -0.07108732888304585, 0.009235024929282007, 0.0006927217092580914, -0.015228845522915358, -0.024409521370828097, 0.0004827579768982195, -0.06202187747032562, -0.023673240975676486, -0.03400389211810551, 0.007157178938073984, -0.04761260183277666, 0.0204341197281747, 0.022664680194524334, 0.010401033404852492, 0.008697039155432252, -0.017288804587612307, -0.0014372089431915738, -0.05476787410835069, -0.0015311268873657972, 0.013199138132199199, -0.052585356878969355, -0.02670085569767487, 0.03566707393767336, 0.060012465833379866, -0.003996137285862926, -0.02823621318140726, -0.0362846571788214, -0.033660907213018336, 0.011010284597163515, -0.022580219219352195, 0.001155671318164308, 0.04806680267139299, -0.009452019202667982, -0.004354488191518582, -0.05782592789360051, -0.00676185477652586, 0.042661346252629385, -0.03790012750498092, 0.10305929566072014, -0.026535330675711663, -0.021587764287808838, -0.024266078698288715, 0.01348807791390313, 0.010840411793525488, -0.0028921297673360413, 0.047378825906091195, 0.0022651073869801755, -0.04003289915665266, 0.002260302822130033, 0.0487498947544618, -0.027992796407840394, -0.041083942806581786, -0.027704915163625166, 0.036497128033279924, 0.00042644730906990535, 0.0036059962198154365, -0.0027645296058582715, -0.013142370447904762, -0.07787757983572999, -0.031147637642388013, 0.0038089337885548573, 0.016756424324964842, 0.019422250254889896, 0.01740058010684729, -0.0348476933329888, -0.03141835689543366, -0.002325545802901391, 0.02733085986506411, -0.016185101278432878, -0.010645164754556445, -0.03441059667856088, 0.011161619955697071, 0.05117580278024565, -0.03329373129549883, -0.041526032303786306, 0.01754206251569615, -0.014397583579125966, -0.007332993283783832, -0.02463349792807948, 0.017943827281922804, 0.026667943359818678, 0.06947696614411214, -0.023640809260336126, 0.0042543953412980985, -0.01959982557145573, 0.023937166402048935, -0.02744851111177892, 0.026240205813919285, -0.0023353057724188634, 0.027815909765041027, -0.002727222620901014, 0.0411794436328937, -0.00016091763573973573, -0.026506433508472253, -0.01741150790382926, 8.57491153554281e-05, 0.013240929107595984, 0.03907459194978786, -0.015173441852455305, -0.00988335658916945, 0.009960825141899958, -0.012321097142553467, -0.008972884291695725, 0.05190624599603911, 0.02974694411068076, -0.052628337489349544, -0.01215049448737004, -0.04527466536441925, -0.00760630483859634, -0.015327669479016356, -0.03446521007683962, 0.00048391925880609225, 0.003977846539990645, 0.03056408296975763, -0.04421369666865516, -0.04308131848538283, -0.020617603451071886, 0.00017710366018875424, -0.030107551663550967, -0.0009185887541203724, 0.002206597362944759, -0.03307961166678831, 0.007709751046850494, 0.032889776343602496, -0.016066520084557622, -0.004554863239620469, -0.03659235737856326, 0.050906384099268336, 0.04763597473253581, 0.012868777477161548, -0.02104875439092679, 0.020801298495470907, 0.039241634815948875, -0.05101930706836193, 0.005683616658618742, -0.004053382279808537, 0.07534844258657067, -0.028823712449391414, 0.011075587190408982, -0.033352479251352866, 0.016915030723527562, 0.009543977137296659, 0.00647749615069211, 0.06638907341401336, -0.009745254124870794, -0.0023226057813220723, -0.007635369862076855, 0.01811449341392413, -0.013122033920680065, 0.03483828311408532, 0.01452119286589061, 0.05959799886492933, 0.015411625888761419, 0.06336716604792503, -0.0035256496230998756, -0.027141539322992035, 0.015441830692513552, 0.005357046998581563, 0.0024720837293726312, -0.0705615075084689, -0.037561179874638355, 0.003581335156894366, -0.020872339521161402, -0.020114368783555336, -0.01716428999807603, -0.0587523628922161, 0.039100875422629584, 0.006767736625361074, -0.05952107152443051, -0.025179853821984628, 0.00787088054631528, -0.013928070461123715, -0.004124445643738691, 0.019998757989610736, 2.5497885365989998e-05, 0.028906617980787606, 0.004196980270343868, 0.0032196830987784517, 0.0009391425865965911, 0.00110486967002907, -0.001773359232317175, -0.0009713337786277232, 0.0006085784635217917, 0.0005965570306355978, 0.0029568624248426816, -0.0051722228081303645, 0.004583318751380693, -0.003090033326892695, 0.0018843240628076629, 0.0012078373109505275, -0.00068285517972401, -0.004548841773936945, 0.0004881929356962777, -0.001273308917142414, 0.0013396765921476024, -0.003150722535686228, 7.187610857967787e-05, 0.004125591766754324, -0.0008730878978483575, 0.0012525757052208814, 0.0004645005461209972, -0.0028060856648247827, -0.0009633094587908847, -0.002880710347672723, 0.004318638922896357, -0.0010255938329925666, -0.000556402910169861, 0.002780560090894944, 9.009363396460365e-06, -0.004258444911072603, 0.0039310622203323625, 0.004052284259532228, -0.0018458574015128217, 0.0015749239947912153, -0.0003160963251473432, 0.0010496521988098213, 0.003241994056507351, -0.0013745989521704864, -6.872365158441606e-05, -0.0005397424149962817, -0.0017474792730138638, -0.0014785844688063833, 0.0016480949791256028, -0.0027956890099397865, 0.0005873801898421294, -0.0030168779318229108, -0.0004166168895956412, -0.0009614901683847658, -0.0006933334890888699, -0.00017542782675434402, -0.001935810222557223, -0.004259993785409462, -0.00037579323874626893, 0.0012969373904902486, -0.0009526052075690685, -0.002364802604514034, -0.0009930323669622352, 0.0043204647892634545, -0.0010933132282631571, -0.0017006040585886301, -2.8019255682885912e-05, 0.0007400172610616732, 0.002718661089908415, 0.0017325820531324302, 0.00022378958294910068, -0.0019238289430592525, -0.0002374966180149001, 0.0015453878793711103, -0.003230380341548213, 0.0012695010325616117, 0.0024580922257055222, -0.0020705529068426, 0.0022566035643254026, -0.0005830417046559852, 0.00046042558353723853, 8.979415662462365e-05, 0.0005019446951200959, -0.0008445893029684592, -0.0002710587249671191, -0.0064596684129874845, -0.0015730220235921086, 0.003498034179083001, -4.8616793695977355e-06, 0.002909383187672168, 0.000153411732924767, -0.002210063075633658, 0.0037139458465007486, -0.0013560100043283276, 0.0016750984114500347, -0.0026473586674069585, 0.0004370608704379589, 0.0038744130305455424, 0.002196399115230885, 0.005568128831470474, 0.003232020980110253, -0.000983410660378578, -0.004384815350814289, 0.002766519088518025, 0.004298960158779436, 0.00082197554286062, 0.004098895514008477, 0.00043563777305837567, 5.3240434347792974e-05, -0.001294574065644848, 0.002255556216992987, 0.0012936323495055756, 0.0003649211855615034, 0.00032884606630029977, 0.002087729481476107, -0.0005434768150104569, 0.0010604683682060262, 0.0002505941516542223, 0.0005279476091413895, 0.0003849819871696137, 6.495866276227466e-05, 0.000789653957519688, 0.0012680355450213276, -0.0015811225441794302, -0.0015125864792562916, 0.000510662456809582, 0.0016407981391344463, 0.0018651534946653413, -0.0030761738871557913, 0.0006017312111984397, -0.003116556422004092, 0.0003677470723654915, -0.0032675306373491646, -0.004393277192269077, -0.004367493537600593, 0.004548916692105042, 0.001957853711701545, -0.0016825264538479479, 0.002433980971376269, 0.0025148134006177623, 0.0018954239539639229, -0.0020194632680986652, -0.0017504159190865093, -0.0031301136642777005, -0.0016737821180152614, 0.002003009695073858, 0.002046297895791724, 0.0011567917996861664, -0.002011415275453957, 0.0009241866360846412, -0.005894152786735757, 0.0030517314185142335, 0.0025844012779688234, 0.0005293755499656605, -0.002051400724685352, 0.0019133944951999285, 0.0008209399283239475, 0.002056872237183956, 0.0008610163030062966, 0.001312959095930839, -0.0020649530507235447, 0.002170591300820082, 0.001401461143078287, 0.0013221143520951515, -0.001650692452341155, -0.001853714417785166, -0.003661060376688448, 0.0007415693086414922, 0.0018131167360048955, 0.005011547459618214, -9.571729116130801e-05, -0.0009526234887271232, -0.0009237122955422624, -0.00023217351827129186, 0.00042450898123469103, 0.00029931015465784415, 0.00078715191284955, -0.0023162427489025706, -0.00239229073650037, 0.0034425436558088297, -0.0012598519352066467, -0.00038092178760957277, -0.001556545342198223, -0.0025462470295487065, -0.003505614330733469, -0.00077618288
'''
List of p-values:
alarkurtti2015: 0.001998001998001998
ding2010: 0.0004997501249375312
fazio2016: 0.15561479506831055
gallezot2010: 0.0024993751562109472
hesse2017: 0.07398520295940812
jaworska2020: 0.006165639060156641
kaller2017: 0.12483930867018997
radnakrishnan2018: 0.0074990626171728535
sandiego2015: 0.04021775358293523
sasaki2012: 0.0013998600139986002
smith2017: 0.03517862012544314

Process finished with exit code 0
'''


import matplotlib.pyplot as plt
import numpy as np

# Convert corr_values_rand to a NumPy array
corr_values_rand_array = np.array(corr_values_rand)

# Split the array into separate arrays for each map
correlation_values_split = np.array_split(corr_values_rand_array, 11)

# List of p-values
p_values = {
    'alarkurtti2015': 0.001998001998001998,
    'ding2010': 0.0004997501249375312,
    'fazio2016': 0.15561479506831055,
    'gallezot2010': 0.0024993751562109472,
    'hesse2017': 0.07398520295940812,
    'jaworska2020': 0.006165639060156641,
    'kaller2017': 0.12483930867018997,
    'radnakrishnan2018': 0.0074990626171728535,
    'sandiego2015': 0.04021775358293523,
    'sasaki2012': 0.0013998600139986002,
    'smith2017': 0.03517862012544314
}

# Correlation values for the original data
original_corr_values = [-0.09825030223635678, -0.1456492918719523, -0.03754042952172708, -0.08235165752460845,
                        -0.04091022193747271, -0.07051887039497798, -0.026292923517916438, -0.06534871934176038,
                        -0.04145179078821774, -0.07794207142407676, -0.040404619037750486]

# Create additional scatter plot for original data of 11 maps
list_orig_corr_values = {'alarkurtti2015': -0.09825030223635678,
    'ding2010': -0.1456492918719523,
    'fazio2016': -0.03754042952172708,
    'gallezot2010': -0.08235165752460845,
    'hesse2017': -0.04091022193747271,
    'jaworska2020': -0.07051887039497798,
    'kaller2017': -0.026292923517916438,
    'radnakrishnan2018': -0.06534871934176038,
    'sandiego2015': -0.04145179078821774,
    'sasaki2012': -0.07794207142407676,
    'smith2017': -0.040404619037750486}


'''
# Create a figure and axis object
fig, ax = plt.subplots(figsize=(10, 6))

# Create boxplots for each set of correlation values
boxplot = ax.boxplot(correlation_values_split)

# Set x-axis tick labels
ax.set_xticklabels(['alarkurtti2015 (DO)', 'ding2010 (NE)', 'fazio2016 (SE)', 'gallezot2010 (SE)', 'hesse2017 (NE)', 'jaworska2020 (DO)', 'kaller2017 (DO)', 'radnakrishnan2018 (SE)', 'sandiego2015 (DO)', 'sasaki2012 (DO)', 'smith2017 (DO)'])

# Set labels and title
ax.set_xlabel('Annotation', fontsize=12)
ax.set_ylabel('Pearson Correlation Coefficient', fontsize=12)
ax.set_title('Spatial Correlation of Randomized tVNS Data with NE, DO, and SE PET Maps', fontsize=16)

# Annotate each boxplot with its corresponding p-value
for i, p_value in enumerate(p_values.values()):
    ax.annotate(f'p-value: {p_value:.4f}', xy=(i + 1, max(correlation_values_split[i])), xytext=(0, 5),
                textcoords='offset points', ha='center', va='bottom', fontsize=10)

# Add dots for the original correlation values
original_scatter = ax.scatter([], [], color='red', label='SC with original data')  # Creating a separate artist for legend

# Add dots for the original correlation values
for i, corr_value in enumerate(original_corr_values):
    ax.scatter(i + 1, corr_value, color='red', zorder=5, label='SC with original data')  # zorder to ensure dots are on top of boxplots

# Add legend
ax.legend(handles=[original_scatter])

# Add grid to the background
ax.grid(True, linestyle='--', linewidth=0.5, color='gray')

# Show plot
plt.tight_layout()
plt.subplots_adjust(bottom=0.2)  # Adjust the bottom margin
plt.xticks(rotation=25)  # Rotate x-axis labels for better visibility
plt.show()
'''
print(len(corr_values_rand_array))



